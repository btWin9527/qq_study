<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>节流</title>
  <style>
    .wrapper {
      width: 100%;
      height: 200px;
      line-height: 200px;
      text-align: center;
      background-color: #000;
      color: #fff;
      font-size: 32px;
    }
  </style>
</head>
<body>
<div class="wrapper">
</div>
<script>
  var wrapper = document.querySelector('.wrapper');
  var count = 1;


  function mousemove(e) {
    wrapper.innerHTML = count++;
    console.log(this);// window
    console.log(e);
  }

  // 节流1(通过节流让代码先执行，然后再等1s执行)
  // 时间戳
  /*function jieliu(callback, ms) {
    var lastTime = 0;
    var that;
    return function (e) {
      that = this;
      var now = Date.now();
      if (now - lastTime > ms) {
        callback.call(that,e);
        lastTime = now;
      }
    }
  }*/

  // 节流2(等待1s之后再进行执行)
  // setTimeout
  /*  function jieliu(callback, ms) {
      var timer;
      var that;
      return function (e) {
        that = this;
        if (!timer) {
          timer = setTimeout(function () {
            callback.call(that,e);
            timer = null;
          }, ms);
        }
      }
    }*/

  // 结合法节流
  function jieliu(callback, ms) {
    var lastTime = 0;
    var timer;
    var that;
    return function (e) {
      that = this;
      var now = Date.now();
      var left = ms - (now - lastTime);
      if (left <= 0) {
        if (timer){
            clearTimeout(timer);
            timer = null;
        }
        lastTime = now;
        callback.call(that,e);
      } else if (!timer) {
        timer = setTimeout(function () {
          lastTime = now;
          callback.call(that,e);
          timer = null;
        }, ms);
      }
    }
  }

  wrapper.addEventListener('mousemove', jieliu(mousemove, 1000, true));


</script>
</body>
</html>